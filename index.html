<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>店舗マップ（営業時間表示付き）</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<style>
  #map { height: 90vh; margin-top: 10px; }
  .weekday-buttons button { margin-right: 4px; padding: 4px 8px; }
  .weekday-buttons button.active { font-weight: bold; background-color: #ddd; }
</style>
</head>
<body>

<div id="controls">
  <div class="weekday-buttons">
    <button data-day="0" class="active">月</button>
    <button data-day="1">火</button>
    <button data-day="2">水</button>
    <button data-day="3">木</button>
    <button data-day="4">金</button>
    <button data-day="5">土</button>
    <button data-day="6">日</button>
  </div>
  <div id="time-label">時間: 12:00</div>
  <input type="range" id="time-slider" min="0" max="23" value="12">
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>

// --- 店舗データ ---
// ここに全店舗データを貼り付けてください
const restaurants = [
  { name:"すき家 本町店", lat:33.5590, lng:133.5310, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"吉野家 高知 高そね店", lat:33.5580, lng:133.5400, hours:[[0,0,24],[1,0,24],[2,0,24],[3,0,24],[4,0,24],[5,0,24],[6,0,24]] },
  { name:"CoCo壱番屋 高知 はりまや橋店", lat:33.5595, lng:133.5325, hours:[[0,10.5,22],[1,10.5,22],[2,10.5,22],[3,10.5,22],[4,10.5,22],[5,10.5,22],[6,10.5,22]] }
  // ...残りの全店舗データをここに貼ってください
];

// --- マップ初期化 ---
const map = L.map('map').setView([33.558, 133.536], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// --- マーカークラスター ---
const markers = L.markerClusterGroup();
map.addLayer(markers);

// --- 曜日・時間管理 ---
let currentDay = 0;   // 月曜
let currentHour = 12; // 12時
const days = ["月","火","水","木","金","土","日"];

function updateMarkers() {
  markers.clearLayers();

  restaurants.forEach(r => {
    // 選択中の曜日の営業時間を取得
    const hours = r.hours.filter(h => h[0] === currentDay);
    
    let nowOpen = false;
    let hoursText = "";
    
    if(hours.length > 0){
      hours.forEach(h=>{
        hoursText += `${days[h[0]]} ${h[1]}:00〜${h[2]}:00<br>`;
        if(currentHour >= h[1] && currentHour < h[2]) nowOpen = true;
      });
    } else {
      hoursText = "営業時間情報なし";
    }

    const status = nowOpen ? "営業中" : "閉店中";

    const m = L.marker([r.lat,r.lng])
      .bindPopup(`<b>${r.name}</b><br>${status}<br>${hoursText}`);
    
    markers.addLayer(m);
  });
}

// --- スライダーイベント ---
const slider = document.getElementById('time-slider');
const timeLabel = document.getElementById('time-label');
slider.addEventListener('input', e=>{
  currentHour = parseInt(e.target.value);
  timeLabel.textContent = `時間: ${currentHour}:00`;
  updateMarkers();
});

// --- 曜日ボタンイベント ---
document.querySelectorAll('.weekday-buttons button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.weekday-buttons button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentDay = parseInt(btn.dataset.day);
    updateMarkers();
  });
});

// --- 初回描画 ---
updateMarkers();

</script>
</body>
</html>
