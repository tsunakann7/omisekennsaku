// --- 店舗データ ---
// 緯度経度は概算です
const restaurants = [
  // すき家
  { name:"すき家 本町店", lat:33.5590, lng:133.5310, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 杉井流店", lat:33.5560, lng:133.5350, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 大原町店", lat:33.5540, lng:133.5300, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 潮新町店", lat:33.5580, lng:133.5400, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 中万々店", lat:33.5550, lng:133.5380, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 南国BP店", lat:33.5670, lng:133.5900, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },
  { name:"すき家 土佐高岡店", lat:33.6320, lng:133.5730, hours:[[0,4,27],[1,4,27],[2,4,27],[3,4,27],[4,4,27],[5,4,27],[6,4,27]] },

  // 吉野家
  { name:"吉野家 高知 高そね店", lat:33.5580, lng:133.5400, hours:[[0,0,24],[1,0,24],[2,0,24],[3,0,24],[4,0,24],[5,0,24],[6,0,24]] },
  { name:"吉野家 高知 東町店", lat:33.5565, lng:133.5330, hours:[[0,5,27],[1,5,27],[2,5,27],[3,5,27],[4,5,27],[5,5,27],[6,5,27]] },
  { name:"吉野家 土佐バイパス店", lat:33.5620, lng:133.5500, hours:[[0,0,24],[1,0,24],[2,0,24],[3,0,24],[4,0,24],[5,0,24],[6,0,24]] },

  // CoCo壱番屋
  { name:"CoCo壱番屋 高知 はりまや橋店", lat:33.5595, lng:133.5325, hours:[[0,10.5,22],[1,10.5,22],[2,10.5,22],[3,10.5,22],[4,10.5,22],[5,10.5,22],[6,10.5,22]] },
  { name:"CoCo壱番屋 高知インター店", lat:33.5620, lng:133.5360, hours:[[0,11,24],[1,11,24],[2,11,24],[3,11,24],[4,11,24],[5,11,24],[6,11,24]] },
  { name:"CoCo壱番屋 高知 介良ケラ店", lat:33.5600, lng:133.5400, hours:[[0,10.5,23.5],[1,10.5,23.5],[2,10.5,23.5],[3,10.5,23.5],[4,10.5,23.5],[5,10.5,23.5],[6,10.5,23.5]] },
  { name:"CoCo壱番屋 高知土佐道路店", lat:33.5610, lng:133.5380, hours:[[0,10.5,22.5],[1,10.5,22.5],[2,10.5,22.5],[3,10.5,22.5],[4,10.5,22.5],[5,10.5,22.5],[6,10.5,22.5]] },
  { name:"CoCo壱番屋 香南野市店", lat:33.6580, lng:133.6120, hours:[[0,10.5,22.5],[1,10.5,22.5],[2,10.5,22.5],[3,10.5,22.5],[4,10.5,22.5],[5,10.5,22.5],[6,10.5,22.5]] },

  // くら寿司
  { name:"くら寿司 高知インター店", lat:33.5620, lng:133.5360, hours:[[0,11,23],[1,11,23],[2,11,23],[3,11,23],[4,11,23],[5,11,23],[6,11,23]] },
  { name:"くら寿司 春野店", lat:33.5500, lng:133.5200, hours:[[0,11,23],[1,11,23],[2,11,23],[3,11,23],[4,11,23],[5,11,23],[6,11,23]] },

  // スシロー
  { name:"スシロー 高知IC店", lat:33.5625, lng:133.5350, hours:[[0,10.5,23],[1,10.5,23],[2,10.5,23],[3,10.5,23],[4,10.5,23],[5,10.5,23],[6,10.5,23]] },
  { name:"スシロー 北新町店", lat:33.5585, lng:133.5335, hours:[[0,11,23],[1,11,23],[2,11,23],[3,11,23],[4,11,23],[5,11,23],[6,11,23]] },
  { name:"スシロー 安岡店", lat:33.5560, lng:133.5300, hours:[[0,10.5,23],[1,10.5,23],[2,10.5,23],[3,10.5,23],[4,10.5,23],[5,10.5,23],[6,10.5,23]] },
  { name:"スシロー 南国店", lat:33.5670, lng:133.5900, hours:[[0,10.5,23],[1,10.5,23],[2,10.5,23],[3,10.5,23],[4,10.5,23],[5,10.5,23],[6,10.5,23]] },

  // はま寿司
  { name:"はま寿司 高知河ノ瀬店", lat:33.5630, lng:133.5400, hours:[[0,11,24],[1,11,24],[2,11,24],[3,11,24],[4,11,24],[5,11,24],[6,11,24]] },
  { name:"はま寿司 高知北金田店", lat:33.5560, lng:133.5330, hours:[[0,5,27],[1,5,27],[2,5,27],[3,5,27],[4,5,27],[5,5,27],[6,5,27]] },
  { name:"はま寿司 南国店", lat:33.5675, lng:133.5910, hours:[[0,11,23],[1,11,23],[2,11,23],[3,11,23],[4,11,23],[5,11,23],[6,11,23]] },
  { name:"はま寿司 四万十店", lat:33.5900, lng:133.6000, hours:[[0,10,23],[1,10,23],[2,10,23],[3,10,23],[4,10,23],[5,10,23],[6,10,23]] },

  // マクドナルド
  { name:"マクドナルド 杉井流店", lat:33.5620, lng:133.5360, hours:[[0,0,24],[1,0,24],[2,0,24],[3,0,24],[4,0,24],[5,0,24],[6,0,24]] },
  { name:"マクドナルド 稲荷町店", lat:33.5550, lng:133.5320, hours:[[0,7,24],[1,7,24],[2,7,24],[3,7,24],[4,7,24],[5,7,24],[6,7,24]] },
  { name:"マクドナルド 帯屋町店", lat:33.5580, lng:133.5330, hours:[[0,6.5,22],[1,6.5,22],[2,6.5,22],[3,6.5,22],[4,6.5,22],[5,6.5,22],[6,6.5,22]] },
  { name:"マクドナルド 春野ケラ店", lat:33.5600, lng:133.5400, hours:[[0,7,24],[1,7,24],[2,7,24],[3,7,24],[4,7,24],[5,7,24],[6,7,24]] },
  { name:"マクドナルド 中万々店", lat:33.5550, lng:133.5380, hours:[[0,7,24],[1,7,24],[2,7,24],[3,7,24],[4,7,24],[5,7,24],[6,7,24]] },
  { name:"マクドナルド はりまや橋3F店", lat:33.5590, lng:133.5325, hours:[[0,10,21],[1,10,21],[2,10,21],[3,10,21],[4,10,21],[5,10,21],[6,10,21]] },
  { name:"マクドナルド 土佐店", lat:33.5580, lng:133.5350, hours:[[0,7,23],[1,7,23],[2,7,23],[3,7,23],[4,7,23],[5,7,23],[6,7,23]] },
  { name:"マクドナルド 五ノ瀬町店", lat:33.5595, lng:133.5315, hours:[[0,6,24],[1,6,24],[2,6,24],[3,6,24],[4,6,24],[5,6,24],[6,6,24]] },
  { name:"マクドナルド 朝倉東町店", lat:33.5555, lng:133.5325, hours:[[0,9,21],[1,9,21],[2,9,21],[3,9,21],[4,9,21],[5,9,21],[6,9,21]] },

  // その他全国チェーン（例）
  { name:"ミスタードーナツ 高知市内", lat:33.5580, lng:133.5330, hours:[[0,10,20],[1,10,20],[2,10,20],[3,10,20],[4,10,20],[5,10,20],[6,10,20]] },
  { name:"モスバーガー 高知市内", lat:33.5585, lng:133.5340, hours:[[0,10,21],[1,10,21],[2,10,21],[3,10,21],[4,10,21],[5,10,21],[6,10,21]] },
  { name:"ケンタッキーフライドチキン 高知店", lat:33.5590, lng:133.5350, hours:[[0,10,22],[1,10,22],[2,10,22],[3,10,22],[4,10,22],[5,10,22],[6,10,22]] },
  { name:"ほっともっと 高知各店", lat:33.5600, lng:133.5360, hours:[[0,10,22],[1,10,22],[2,10,22],[3,10,22],[4,10,22],[5,10,22],[6,10,22]] },
  { name:"なか卯 高知各店", lat:33.5570, lng:133.5320, hours:[[0,0,24],[1,0,24],[2,0,24],[3,0,24],[4,0,24],[5,0,24],[6,0,24]] },
  { name:"サーティワンアイスクリーム 高知各店", lat:33.5585, lng:133.5345, hours:[[0,10,21],[1,10,21],[2,10,21],[3,10,21],[4,10,21],[5,10,21],[6,10,21]] },
  { name:"やいろ亭（ひろめ市場内）", lat:33.5595, lng:133.5330,
    hours:[
      [0,10.5,21],[1,11.5,22],[2,11.5,22],[3,11.5,22],[4,11.5,22],[5,11.5,22],[6,11.5,22]
    ]
  },
  { name:"須崎魚河岸 魚貴 追手筋店", lat:33.5615, lng:133.5363,
    hours:[
      [0,17,24],[1,17,24],[2,17,24],[3,17,24],[4,17,24],[5,17,25],[6,17,25]
    ]
  },
  { name:"須崎魚河岸 魚貴 はなれ", lat:33.5616, lng:133.5364,
    hours:[
      [1,17,24],[2,17,24],[3,17,24],[4,17,24],[5,17,24],[6,17,24]
    ]
  },
  { name:"須崎魚河岸 魚貴 万々店", lat:33.5535, lng:133.5335,
    hours:[
      [0,11,14],[0,17,23],[1,11,14],[1,17,23],[2,11,14],[2,17,23],
      [3,11,14],[3,17,23],[4,11,14],[4,17,23],[5,11,14],[5,17,23],
      [6,11,14],[6,17,23]
    ]
  },
  { name:"菊寿し 本店", lat:33.5585, lng:133.5335,
    hours:[
      [1,11,18],[2,11,18],[4,11,18],[5,11,15],[5,17,21],[6,11,15],[6,17,21],[0,11,15],[0,17,21]
    ]
  },
  { name:"追手筋 宴舞堂", lat:33.5619, lng:133.5367,
    hours:[
      [0,12,16],[0,17,25],[1,12,16],[1,17,25],[2,12,16],[2,17,25],
      [3,12,16],[3,17,25],[4,12,16],[4,17,25],[5,12,16],[5,17,25],
      [6,12,16],[6,17,27]
    ]
  },
  { name:"海鮮料理 海ぼうず", lat:33.5620, lng:133.5368,
    hours:[
      [0,11,14],[0,17,22],[1,11,14],[1,17,22],[2,11,14],[2,17,22],
      [3,11,14],[3,17,22],[4,11,14],[4,17,22],[5,11,14],[5,17,22],
      [6,11,14],[6,17,22]
    ]
  },
  { name:"酒菜浪漫亭 高知本店", lat:33.5621, lng:133.5369,
    hours:[
      [1,17,22],[2,17,22],[3,17,22],[4,17,22],[5,17,22],[6,17,22]
    ]
  },
  { name:"酒膳皿 蛍槍", lat:33.5622, lng:133.5370,
    hours:[
      [1,17,22.5],[2,17,22.5],[3,17,22.5],[4,17,22.5],[5,17,22.5],[6,17,22.5]
    ]
  },
  { name:"新中国料理 彩華", lat:33.5623, lng:133.5371,
    hours:[
      [2,11.5,14.5],[2,17.5,22],[3,11.5,14.5],[3,17.5,22],[4,11.5,14.5],[4,17.5,22],
      [5,11.5,14.5],[5,17.5,22],[6,11.5,14.5],[6,17.5,22],[0,11.5,14.5],[0,17.5,22]
    ]
  },
  { name:"居酒屋 うめ丸", lat:33.5624, lng:133.5372,
    hours:[
      [1,17.5,24],[2,17.5,24],[3,17.5,24],[4,17.5,24],[5,17.5,24],[6,17.5,24]
    ]
  },
  { name:"居酒屋 お箸の国", lat:33.5625, lng:133.5373,
    hours:[
      [1,17.5,23.5],[2,17.5,23.5],[3,17.5,23.5],[4,17.5,23.5],[5,17.5,23.5],[6,17.5,23.5]
    ]
  },
  { name:"寿し柳", lat:33.5560, lng:133.5340,
    hours:[
      [0,11,21],[1,11,21],[2,11,21],[3,11,21],[4,11,21],[5,11,21],[6,11,21]
    ]
  },
  { name:"高知の地酒と生カツオ 酒蔵居酒屋 堀川", lat:33.5565, lng:133.5345,
    hours:[
      [2,18,23.5],[3,18,23.5],[4,18,23.5],[5,18,23.5],[6,18,23.5],[0,17,22.5]
    ]
  },
  { name:"仕出しのあんどう（ひろめ市場内）", lat:33.5596, lng:133.5331,
    hours:[
      [0,11,20.5],[1,11,20.5],[4,11,20.5],[5,11,20.5],[6,11,20.5]
    ]
  }
];



// --- マップ初期化 ---
const map = L.map('map').setView([33.558, 133.536], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// --- マーカークラスター ---
const markers = L.markerClusterGroup();
restaurants.forEach(r=>{
  const marker = L.marker([r.lat,r.lng]);
  marker.bindPopup(`<b>${r.name}</b><br><span class="hours"></span>`);
  marker.restaurant = r;
  markers.addLayer(marker);
});
map.addLayer(markers);

// --- 曜日・時間管理 ---
let currentDay = 0;   // 月曜
let currentHour = 12; // 12時

function updateMarkers() {
  markers.clearLayers();
  restaurants.forEach(r=>{
    const hours = r.hours.find(h=>h[0]===currentDay);
    if(hours && currentHour >= hours[1] && currentHour < hours[2]){
      const m = L.marker([r.lat,r.lng])
        .bindPopup(`<b>${r.name}</b><br>${hours[1]}:00〜${hours[2]}:00`);
      markers.addLayer(m);
    }
  });
}

// --- スライダーイベント ---
const slider = document.getElementById('time-slider');
const timeLabel = document.getElementById('time-label');
slider.addEventListener('input', e=>{
  currentHour = parseInt(e.target.value);
  timeLabel.textContent = `時間: ${currentHour}:00`;
  updateMarkers();
});

// --- 曜日ボタンイベント ---
document.querySelectorAll('.weekday-buttons button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.weekday-buttons button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentDay = parseInt(btn.dataset.day);
    updateMarkers();
  });
});

// --- 初期表示 ---
updateMarkers();
